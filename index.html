<html>
<head>
	<title>Bio World</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- <link rel="stylesheet" href="css/shared.css?v=1"> -->
	<link rel="stylesheet" href="css/mainMenu.css?v=1">
	<link rel="stylesheet" href="css/game.css?v=1">
	<script src="js/jquery.js.min?v=1"></script>
</head>
<body>
	<header><h1>Bio World</h2></header>
	<div id="canvas"></div>
	<footer>&copy Brian Feldman, 2014</footer>
</body>
<script type="text/javascript">
(function(){
	
	var currentState = "MainMenu";

	var MainMenu = {

		selectedOption: 0,
		menuToggleAudio: new Audio('media/audio/menuToggleAudio.m4a'),
		buttons: ["Plain Mode", "Game Mode", "Hxck3r Mode"],
		
		render: function(){
			
			
			this.mainMenu = document.createElement('div');
			this.mainMenu.id = "mainMenu";
			$('#canvas').append(this.mainMenu);

			for(i=0; i<this.buttons.length; i++){
				
				this.span = document.createElement('span');
				this.span.setAttribute('class', 'menuOption');
				$(this.span).addClass(i ? '':'selected');
				this.mainMenu.appendChild(this.span);

				this.h2 = document.createElement('h2');
				this.h2.innerHTML = this.buttons[i];
				this.span.appendChild(this.h2);

				console.log(this.buttons[i]);
			}

			this.loadKeysController();
			this.loadClickController();
		},

		changeMenuSelection: function(){
			if($(window).width()>1000){
				this.playMenuToggleSound();
			}
			console.log(this.selectedOption);
			$(".menuOption").removeClass("selected");
			$(".menuOption:eq("+this.selectedOption+")").addClass("selected");
		},
	
		playMenuToggleSound: function(){
			this.menuToggleAudio.pause();
			this.menuToggleAudio.currentTime = 0;
			this.menuToggleAudio.play();
		},

		loadKeysController: function(){
			$(window).keydown(function(e) {
				var key = e.which;
		        //console.log(key);
		        switch (key){
		       		case 38: //up
		       			if(MainMenu.selectedOption>0){
		       				MainMenu.selectedOption--;
		       			}else{ //Allow this for wrap around
		       				//selectedOption = $('.menuOption').length-1;
		       			}
		       			
		       			MainMenu.changeMenuSelection();
		       			break;
		       		
		       		case 40: //down
		       			if(MainMenu.selectedOption<($('.menuOption').length-1)){
		       				MainMenu.selectedOption++;
		       			}else{ //Allow this for wrap around
		       				//selectedOption = 0;
		       			}
		       			
		       			MainMenu.changeMenuSelection();
		       			break;
		       	
		       		case 13: //enter
		       			MainMenu.submitMenuSelection();
		       		
		       		default:
		       			break;
				}
			});
		},

		loadClickController: function(){
			
			$(".menuOption").bind("click touchstart", function(){
				MainMenu.selectedOption = $(this).index();
				MainMenu.changeMenuSelection(MainMenu.selectedOption);
				MainMenu.submitMenuSelection();
			});
		},

		submitMenuSelection: function(){
			switch (this.selectedOption){
			 	case 0:
			 		console.log("Entering plainWorld");
			 		currentState = "PlainWorld";
			 		renderPage();
			 		break;
			 	case 1:
			 		console.log("Entering gameWorld");
			 		currentState = "GameWorld";
			 		renderPage();
			 		break;
			 	case 2:
			 		console.log("Entering hackerWorld");
			 		currentState = "HackerWorld";
			 		renderPage();
			 		break;
			 	default:
			 		break;
			}
		}
		
	};
	
	var GameWorld = {
		
		height: $("body").height()-100,
		getCharBot: function(){
			return parseInt($(".character").css("bottom"), 10);
		},
		getCharMargL: function(){
			return parseInt($(".character").css("margin-left"), 10);
		},
		getDocWidth: function(){
			return parseInt($(document).width()+"px", 10);
		},

		render: function(){
			this.gameWorld = document.createElement('div');
			this.gameWorld.id = "gameWorld";
			this.gameWorld.style.height = this.height;
			$('#canvas').append(this.gameWorld);

			this.character = document.createElement('div');
			this.character.setAttribute('class', 'character');
			this.gameWorld.appendChild(this.character);

			this.scene = document.createElement('div');
			this.scene.setAttribute('class', 'scene');
			this.gameWorld.appendChild(this.scene);

			this.loadKeysController();
		},

		loadKeysController: function(){
			$(window).keydown(function(e) {
				var key = e.which;
		        //console.log(key);
		        switch (key){
		       		case 38: //up
		       			
		       			if(GameWorld.getCharBot()<(GameWorld.height*.5)){
		       				$(".character").css({bottom: '+=10px'});
		       			}	
		       			break;
		       		
		       		case 40: //down
		       			
		       			var charBot = parseInt($(".character").css("bottom"), 10);
		       			if(GameWorld.getCharBot()>0){
		       				$(".character").css({bottom: '-=10px'});
		       			}
		       			break;
		       		
		       		case 37: //left
		       			
		       			if($(".character").css('margin-left')>='0px'){
		       				$(".character").css({marginLeft: '-=20px'});
		       				$(".character").addClass("flipped");
		       			}
		       			
		       			break;
		       	
		       		case 39: //right
		       			
		       			var charMargL = parseInt($(".character").css("margin-left"), 10);
		       			var docW = parseInt($(document).width()+"px", 10);

		       			if(GameWorld.getCharMargL()<(GameWorld.getDocWidth()-50)){
		       			 	$(".character").css({marginLeft: '+=20px'});
		       			 	$(".character").removeClass("flipped");
		       			}
		       			break;

		       		case 13: //enter
		       		
		       			break;
		       		
		       		default:
		       			break;
		        }
			});
		},
	};

	function renderPage(){
		$(window).unbind('keydown');
		$("#canvas").empty();
		switch (currentState){
			case "MainMenu":
				MainMenu.render();
				break;
			case "PlainWorld":
				PlainWorld.render();
				break;
			case "GameWorld":
				GameWorld.render();
				break;
			case "HackerWorld":
				HackerWorld.render();
				break;
			default:
				currentState = "MainMenu";
				renderPage();
				break;
		}
	}

	renderPage();

})();

</script>
</html>